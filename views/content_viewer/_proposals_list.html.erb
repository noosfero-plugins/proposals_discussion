<script src="/javascripts/plugins/proposals_discussion/jquery.jscroll.min.js" type="text/javascript"></script>
<script>
  jQuery(document).ready(function($) {
    function proposalsScroll() {
      $('.proposals').data('jscroll', null);
      $('.proposals').jscroll({
        loadingHtml: '<img src="/images/loading.gif" alt="Loading" /> <%= _("Loading...") %>',
        nextSelector: 'div.more a'
      });
      $('.proposals').trigger('scroll.jscroll');
    }
    proposalsScroll();

    $('.proposals_list .filters a.order').on('ajax:success', function(event, data, status, xhr) {
      $('.proposals_list .filters a.order').removeClass('selected');
      $(this).addClass('selected');
      $(this).parents('div.proposals_list').find('.proposals').html(data);
      proposalsScroll();
    });
  });
</script>

<% extend ProposalsDiscussionPlugin::ProposalsListHelper %>

<% private_proposals = user ? @page.proposals.private(user) : [] %>
<% unless private_proposals.empty? %>
<div class="private-proposals">
  <h5><%= _('My private proposals') %></h5>
  <%= render :partial => 'content_viewer/proposal_card', :collection => private_proposals %>
</div>
<% end %>

<% order ||= 'random' %>
<div class="proposals_list">
  <h5><%= _('Proposals') %></h5>
  <div class="filters">
    <% [[_('Random'), :random], [_('Aplhabetical'), :alphabetical]].each_with_index do |order, i| %>
      <%= link_to order.first, url_for({:controller => 'proposals_discussion_plugin_public', :action => 'load_proposals', :holder_id => holder.id, :profile => profile.identifier, :order => order.second}), :remote => true, :class => "order #{order.second} #{i==0 ? 'selected':''}" %>
    <% end %>
  </div>
  <div class="clear"></div>

  <div class="proposals">
    <div class="more">
      <img src="/images/loading.gif" alt="Loading" /><%= _("Loading...") %>
      <%= more_proposals('', holder, order) %>
    </div>
  </div>
</div>
